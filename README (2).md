# Smart Delivery Platform

**Version:** 1.0

---

## نطاق المشروع والأهداف

### تعريف المشكلة

يهدف المشروع إلى معالجة أوجه القصور في خدمات التوصيل الحالية، وتقديم حلول مبتكرة لتجاوز القيود الموجودة.

-   **أوجه القصور في خدمات التوصيل الحالية:**
    *   بطء في عملية التوصيل.
    *   نقص في الموثوقية.
    *   تجربة مستخدم غير مرضية.
-   **قيود الحلول الحالية:**
    *   عدم كفاءة في إدارة الموارد.
    *   نقص في التواصل والتتبع.
    *   صعوبة التكيف مع الاحتياجات المتغيرة.

### أهداف المشروع

يسعى المشروع لتحقيق الأهداف التالية:

-   **تحسين سرعة التوصيل:** تقليل مدة التوصيل.
-   **تعزيز الموثوقية:** ضمان وصول الطلبات في الوقت المحدد وبأمان.
-   **توفير تجربة مستخدم متميزة:** تصميم واجهات سهلة الاستخدام وخدمات عالية الجودة.

### الافتراضات والقيود الأولية

سيتم تحديد الافتراضات والقيود الأولية لاحقًا.

---

## هيكل المشروع

### مراحل دورة حياة المشروع

-   **البدء (Initiation - IN):**
    -   **تحديد النطاق (Scope Definition):** تحديد نطاق المشروع.
    -   **تحديد الأهداف (Goal Setting):** تحديد أهداف المشروع.
    -   **جمع المتطلبات (Requirements Gathering):** جمع متطلبات المشروع.
-   **التخطيط (Planning - PL):**
    -   **تقسيم المهام (Task Breakdown):** تقسيم المشروع إلى مهام فرعية.
    -   **إنشاء الجدول الزمني (Timeline Creation):** وضع جدول زمني للمشروع.
    -   **توزيع الموارد (Resource Allocation):** تحديد الموارد اللازمة وتوزيعها.
    -   **وضع الميزانية (Budgeting):** تحديد ميزانية المشروع.
-   **التصميم (Design - DS):**
    -   **تصميم البنية (Architecture Design):** تصميم البنية العامة للنظام.
    -   **تصميم قاعدة البيانات (Database Design):** تصميم مخطط قاعدة البيانات.
    -   **تصميم واجهة برمجة التطبيقات (API Design):** تصميم واجهات برمجة التطبيقات.
    -   **تصميم واجهة المستخدم (UI/UX Design):** تصميم واجهات المستخدم وتجربة المستخدم.
-   **الاختبار (Testing - TS):**
    -   **اختبارات الوحدة (Unit Testing - UT):** اختبار الوحدات الفردية.
    -    **تصميم البنية (Architecture Design):** تصميم البنية العامة للنظام.
        -    **إدارة المستخدمين (User Management - USMG):**
             -   **التواصل عبر واجهات برمجة التطبيقات (API-Based Communication - API):** استخدام واجهات برمجة التطبيقات (APIs) للتواصل وتبادل البيانات بين مكونات النظام.
        - **المصادقة والتفويض (Authentication and Authorization - AUTH):** التقنيات والبروتوكولات المستخدمة لمصادقة المستخدمين وتفويضهم عبر المنصة.
            -   **بروتوكولات المصادقة (Authentication Protocols - PROTO):** البروتوكولات المحددة المستخدمة (مثل OAuth 2.0، JWT) (سيتم تحديد التفاصيل لاحقًا).
            -   **الاعتبارات الأمنية (Security Considerations - SEC):** التدابير الأمنية لحماية بيانات اعتماد المستخدمين ومنع الوصول غير المصرح به (سيتم تحديد التفاصيل لاحقًا).
            -   **الأدوار والأذونات (Roles and Permissions - ROLES):** كيفية تحديد أدوار المستخدمين المختلفة ومنحهم حق الوصول إلى وظائف معينة (سيتم تحديد التفاصيل لاحقًا).

                  -   **هيكل واجهات برمجة التطبيقات (API Architecture - ARCH):** الهيكل العام لواجهات برمجة التطبيقات (مثل RESTful أو GraphQL) (سيتم تحديد التفاصيل لاحقًا).
                  -   **تنسيق البيانات (Data Format - FMT):** تنسيق البيانات المستخدم في طلبات واستجابات واجهات برمجة التطبيقات (مثل JSON أو XML) (سيتم تحديد التفاصيل لاحقًا).
                  -   **توثيق واجهات برمجة التطبيقات (API Documentation - DOC):** وثائق ومواصفات واجهات برمجة التطبيقات (سيتم تحديد التفاصيل لاحقًا).
             -   **قاعدة البيانات (Database - DB):** اختيار تقنية قاعدة البيانات، وتصميم المخطط، واعتبارات إدارة البيانات.
                  -   **نوع قاعدة البيانات (Database Type - TYPE):** نوع قاعدة البيانات (مثل علائقية أو NoSQL) (سيتم تحديد التفاصيل لاحقًا).
                  -   **تصميم المخطط (Schema Design - SCHEMA):** هيكل وتنظيم البيانات داخل قاعدة البيانات (سيتم تحديد التفاصيل لاحقًا).
                  -   **كيانات البيانات (Data Entities - DATA):** كيانات البيانات الرئيسية المخزنة في قاعدة البيانات (مثل المستخدمين والطلبات والمتاجر وعناصر القائمة) (سيتم تحديد التفاصيل لاحقًا).
             -    **مجموعة التقنيات (Technology Stack - STACK):** لغات البرمجة والأطر والأدوات الأخرى المستخدمة في المنصة (سيتم تحديد التفاصيل لاحقًا).
                -   **طرق الدفع المدعومة (Supported Payment Methods - TYPE):** طرق الدفع المختلفة التي تدعمها المنصة (مثل بطاقات الائتمان/الخصم، المحافظ الرقمية، الدفع عند الاستلام) (سيتم تحديد التفاصيل لاحقًا).
                -   **عمليات تكامل البوابة (Gateway Integrations - INTG):** بوابات الدفع المحددة المدمجة مع المنصة (مثل Stripe، PayPal) (سيتم تحديد التفاصيل لاحقًا).
            -   **إدارة المعاملات (Transaction Management - TRAN):** التعامل مع معاملات الدفع، بما في ذلك المعالجة والمبالغ المستردة والمنازعات.
                -   **معالجة المعاملات (Transaction Processing - PROC):** المراحل المختلفة لمعاملة الدفع (مثل البدء والتفويض والاستيلاء والتسوية) (سيتم تحديد التفاصيل لاحقًا).
                -   **حالات المعاملة (Transaction Statuses - STAT):** الحالات المحتملة للمعاملة (مثل معلقة، مصرح بها، مستولى عليها، مستقرة، فاشلة، مستردة) (سيتم تحديد التفاصيل لاحقًا).
                -   **التعامل مع الأخطاء (Error Handling - ERR):** التعامل مع المعاملات الفاشلة وإبلاغ الأخطاء للمستخدم أو الأطراف المعنية (سيتم تحديد التفاصيل لاحقًا).
                -   **المبالغ المستردة (Refunds - RFND):** عملية بدء ومعالجة المبالغ المستردة (سيتم تحديد التفاصيل لاحقًا).
                -   **المنازعات (Disputes - DSPT):** التعامل مع منازعات الدفع وعمليات رد المبالغ المدفوعة (سيتم تحديد التفاصيل لاحقًا).
            -   **التدابير الأمنية (Security Measures - SEC):** بروتوكولات وتدابير أمنية لحماية معلومات الدفع ومنع الاحتيال.
                -   **التشفير (Encryption - ENCR):** استخدام التشفير لحماية بيانات الدفع الحساسة أثناء النقل والتخزين (سيتم تحديد التفاصيل لاحقًا).
                -   **الترميز (Tokenization - TOKN):** استخدام الرموز المميزة لاستبدال بيانات الدفع الحساسة برموز غير حساسة (سيتم تحديد التفاصيل لاحقًا).
                -   **الامتثال لـ PCI DSS (PCI DSS Compliance - PCI):** الامتثال لمعيار أمان بيانات صناعة بطاقات الدفع (PCI DSS) (سيتم تحديد التفاصيل لاحقًا).
                -   **اكتشاف الاحتيال (Fraud Detection - FRAD):** آليات وأدوات لاكتشاف المعاملات الاحتيالية ومنعها (سيتم تحديد التفاصيل لاحقًا).
        - **بنية معالجة الدفع (Payment Processing Infrastructure - PYMT):** التقنيات والخدمات المستخدمة للتعامل مع المدفوعات، بما في ذلك بوابات الدفع والتدابير الأمنية وإدارة المعاملات.
            -   **بوابات الدفع (Payment Gateways - GATE):** التكامل مع بوابات دفع تابعة لجهات خارجية (مثل Stripe، PayPal).

        - **تقنيات إعداد التقارير والتحليلات (Reporting and Analytics Technologies - RPTA):** التقنيات المستخدمة لجمع البيانات وتخزينها ومعالجتها وتحليلها وتصورها لإعداد التقارير والتحليلات.
            -   **جمع البيانات (Data Collection - COLL):** أدوات وتقنيات لجمع البيانات من مصادر مختلفة داخل المنصة (سيتم تحديد التفاصيل لاحقًا).
            -   **تخزين البيانات (Data Storage - STOR):** قواعد البيانات أو مستودعات البيانات المستخدمة لتخزين البيانات لإعداد التقارير والتحليلات (سيتم تحديد التفاصيل لاحقًا).
            -   **معالجة البيانات (Data Processing - PROC):** أدوات وتقنيات لمعالجة البيانات وتحويلها للتحليل (مثل عمليات ETL) (سيتم تحديد التفاصيل لاحقًا).
            -   **تحليل البيانات (Data Analysis - ANAL):** الأساليب والخوارزميات المستخدمة لتحليل البيانات وتوليد رؤى (سيتم تحديد التفاصيل لاحقًا).
            -   **تصور البيانات (Data Visualization - VIS):** الأدوات والمنصات المستخدمة لإنشاء التقارير ولوحات المعلومات والرسوم البيانية (سيتم تحديد التفاصيل لاحقًا).
        - **التقارير والتحليلات (Reporting and Analytics - RPT):** الميزات والأدوات لإنشاء التقارير وتحليل البيانات المتعلقة باستخدام النظام والأداء والمقاييس التجارية.
            - **تقارير أداء المتجر (Store Performance Reporting - STOR):** تقارير ولوحات معلومات للمتاجر لتتبع مبيعاتها وتنفيذ الطلبات والمقاييس الرئيسية الأخرى (يمكن الوصول إليها من قبل مديري المتاجر وأصحاب المتاجر).
                - **تقارير المبيعات (Sales Reports - SALE):** تقارير عن أداء المبيعات والإيرادات والعناصر الشائعة (سيتم تحديد التفاصيل لاحقًا).
                - **تقارير الطلبات (Order Reports - ORDR):** تقارير عن حجم الطلبات ومعدلات التنفيذ وأوقات التسليم (سيتم تحديد التفاصيل لاحقًا).
                - **تقارير العناصر (Item Reports - ITEM):** تقارير عن شعبية العناصر واتجاهات المبيعات ومستويات المخزون (سيتم تحديد التفاصيل لاحقًا).
            - **تحليلات العمليات (Operations Analytics - OPAN):** تحليل البيانات على مستوى المنصة لتحسين العمليات وتحديد الاتجاهات وتحسين الكفاءة (يمكن الوصول إليها من قبل مديري العمليات ومسؤولي المنصة).
                - **لوحات معلومات التشغيل (Operational Dashboards - DASH):** لوحات معلومات في الوقت الفعلي لمراقبة مقاييس التشغيل الرئيسية (مثل الطلبات النشطة وتوفر السائق وأوقات التسليم) (سيتم تحديد التفاصيل لاحقًا).
                - **تحليل الاتجاهات (Trend Analysis - TREND):** تحليل الاتجاهات في حجم الطلبات وأنماط التسليم وسلوك المستخدم (سيتم تحديد التفاصيل لاحقًا).
                - **تحليل الكفاءة (Efficiency Analysis - EFFC):** تحليل الكفاءة التشغيلية، بما في ذلك أوقات التسليم واستخدام السائق وعمليات تنفيذ الطلبات (سيتم تحديد التفاصيل لاحقًا).
            - **تحليلات العملاء (Customer Analytics - CUST):** تحليل سلوك العملاء وتفضيلاتهم لتحسين تجربة المستخدم وتخصيص العروض (يمكن الوصول إليها من قبل فرق التسويق ومسؤولي المنصة).
                - **التحليل السلوكي (Behavioral Analysis - BEHV):** تحليل سلوك العملاء، بما في ذلك أنماط الطلب والعناصر المفضلة واستخدام ميزات المنصة (سيتم تحديد التفاصيل لاحقًا).
                - **تقسيم العملاء (Customer Segmentation - SEG):** تقسيم العملاء بناءً على سلوكهم وتفضيلاتهم وتركيبتهم السكانية (سيتم تحديد التفاصيل لاحقًا).
                - **التخصيص (Personalization - PRSN):** تخصيص العروض والتوصيات والعروض الترويجية للمستخدمين الأفراد بناءً على البيانات (سيتم تحديد التفاصيل لاحقًا).
        - **إدارة مستخدمي العملاء (Customer User Management - CUST):** الوظائف الخاصة بإدارة حسابات العملاء.
            - **التسجيل (Registration - REG):** عملية إنشاء حساب جديد للعملاء.
            - **المصادقة (Authentication - AUTH):** التحقق من هوية العميل (مثل تسجيل الدخول، إعادة تعيين كلمة المرور).
            - **إدارة الملف الشخصي (Profile Management - PROF):** إدارة معلومات الملف الشخصي للعميل (مثل الاسم، تفاصيل الاتصال، العناوين، طرق الدفع).
            - **سجل الطلبات (Order History - HIST):** الوصول إلى الطلبات السابقة وعرضها.
            - **التفضيلات (Preferences - PREF):** إدارة تفضيلات العميل (مثل المتاجر المفضلة، القيود الغذائية).
        - **إدارة مستخدمي السائقين (Driver User Management - DRIV):** الوظائف الخاصة بإدارة حسابات السائقين.
            - **التسجيل والتفعيل (Onboarding - ONB):** عملية تسجيل السائقين الجدد وتفعيلهم على المنصة، بما في ذلك التحقق من الخلفية والمستندات.
            - **المصادقة (Authentication - AUTH):** التحقق من هوية السائق (مثل تسجيل الدخول، إعادة تعيين كلمة المرور).
            - **إدارة الملف الشخصي (Profile Management - PROF):** إدارة معلومات الملف الشخصي للسائق (مثل الاسم، تفاصيل الاتصال، معلومات السيارة، التوفر).
            - **الأرباح والمدفوعات (Earnings and Payments - EARN):** إدارة أرباح السائق وسجل المدفوعات وطرق السحب.
            - **التقييمات والمراجعات (Ratings and Reviews - RTNG):** الوصول إلى تقييمات ومراجعات العملاء والرد عليها.
        - **إدارة مستخدمي موظفي المتجر (Store Personnel User Management - STOR):** الوظائف الخاصة بإدارة حسابات موظفي المتجر.
            - **إنشاء الحساب (Account Creation - REG):** عملية إنشاء حسابات لموظفي المتجر، والتي يحتمل أن تكون مرتبطة بمتجر معين.
            - **إدارة الملف الشخصي (Profile Management - PROF):** إدارة معلومات الملف الشخصي لموظفي المتجر (مثل الاسم، تفاصيل الاتصال، الدور داخل المتجر).
            - **الأذونات والأدوار (Permissions and Roles - PERM):** إدارة أذونات الوصول والأدوار لموظفي المتجر المختلفين داخل لوحة تحكم المتجر.
    -    **تصميم قاعدة البيانات (Database Design):** تصميم مخطط قاعدة البيانات.

    -   **تصميم واجهة المستخدم (UI/UX Design):** تصميم واجهات المستخدم وتجربة المستخدم.
-   **التطوير (Development - DV):**
    -   **تطوير الواجهة الأمامية (Frontend Development - FE):** تطوير واجهات المستخدم.
    -   **تطوير الواجهة الخلفية (Backend Development - BE):** تطوير منطق التطبيق والخوادم.
    -   **تطوير تطبيقات الهاتف (Mobile App Development - MA):** تطوير تطبيقات الهاتف.
        -   **تطوير تطبيقات iOS (iOS Development):** تطوير تطبيقات iOS.
        -   **تطوير تطبيقات Android (Android Development):** تطوير تطبيقات Android.
-   **الاختبار (Testing - TS):**
    -   **اختبارات الوحدة (Unit Testing - UT):** اختبار الوحدات الفردية.
    -   **اختبارات التكامل (Integration Testing - IT):** اختبار تكامل الوحدات.
    -   **اختبارات النظام (System Testing - ST):** اختبار النظام ككل.
    -   **اختبار قبول المستخدم (User Acceptance Testing - UAT):** اختبار النظام من قبل المستخدمين.
-   **النشر (Deployment - DP):**
    -   **إعداد البنية التحتية (Infrastructure Setup - INF):** إعداد الخوادم والشبكات.
    -   **إدارة الإصدارات (Release Management - REL):** إدارة إصدارات البرمجيات.
    -   **المراقبة والتسجيل (Monitoring and Logging - MON):** مراقبة أداء النظام وتسجيل الأحداث.
-   **الصيانة (Maintenance - MT):**
    -   **إصلاح الأخطاء (Bug Fixing - BF):** إصلاح الأخطاء والعيوب.
    -   **تحسين الأداء (Performance Optimization - PO):** تحسين أداء النظام.
    -   **الدعم المستمر (Ongoing Support - SUP):** تقديم الدعم للمستخدمين.
-   **التطوير المستمر (Evolution - EV):**
    -   **تطوير ميزات جديدة (New Feature Development - NF):** إضافة ميزات جديدة.
    -   **التوسع والتحسين (Scaling and Optimization - SC):** توسيع النظام وتحسينه.
    -   **التكيف مع المتطلبات (Adapting to Requirements - AR):** التكيف مع المتطلبات المتغيرة.

### المخاوف متعددة المراحل

-   **الأمان (Security - SEC):**
    -   **المصادقة (Authentication - AUTH):** التحقق من هوية المستخدمين.
    -   **التفويض (Authorization - AZ):** تحديد صلاحيات المستخدمين.
    -   **أمن البيانات (Data Security - DATA):** حماية البيانات.
-   **ضمان الجودة (Quality Assurance - QA):**
    -   **مراجعة الكود (Code Reviews - CODE):** مراجعة الكود للتأكد من جودته.
    -   **استراتيجيات الاختبار (Testing Strategies - TEST):** وضع استراتيجيات للاختبار.
-   **الجوانب القانونية والامتثال (Legal and Compliance - LC):**
    -   **الامتثال للائحة العامة لحماية البيانات (GDPR Compliance - GDPR):** الامتثال للوائح حماية البيانات.
    -   **شروط الخدمة (Terms of Service - TOS):** وضع شروط الخدمة.
-   **الأعمال والتسويق (Business and Marketing - BM):**
    -   **استراتيجية العمل (Business Strategy - STRAT):** وضع استراتيجية العمل.
    -   **التسويق والمبيعات (Marketing and Sales - MKT):** وضع خطط التسويق والمبيعات.

### منصة التوصيل الذكية (Smart Delivery Platform - SDP)

-   **تطبيق العميل (Customer App - C):**
    -   **ربط بمرحلة تطوير الواجهة الأمامية (relates to OP > DV > FE)**
    -   **ربط بمرحلة تطوير تطبيقات الهاتف (relates to OP > DV > MA)**
-   **تطبيق السائق (Driver App - D):**
    -    **ربط بمرحلة تطوير تطبيقات الهاتف (relates to OP > DV > MA)**
        -   **إدارة التوفر (Availability Management - AVIL):** تحديد حالة التوفر (مثل متصل/غير متصل) لقبول طلبات التوصيل.
        -   **إدارة طلبات التوصيل (Delivery Request Management - RQST):** استقبال طلبات التوصيل وقبولها/رفضها.
        -   **التنقل والتوجيه (Navigation and Routing - NAVG):** التنقل إلى مواقع الاستلام والتوصيل، مع تكامل الخرائط والتوجيه.
        -   **إدارة الطلبات (عرض السائق) (Order Management (Driver View) - ORDM):** إدارة الطلبات المعينة، وتحديث حالة الطلب (مثل تم الاستلام، قيد التوصيل، تم التوصيل)، وعرض تفاصيل الطلب (مثل العناصر، معلومات العميل، تعليمات التوصيل).
        -   **الاتصال (السائق) (Communication (Driver) - COMM):** التواصل مع العملاء والمتاجر (مثل تأكيد الاستلام، الإخطار بالتأخير).
        -   **تتبع الأرباح (عرض السائق) (Earnings Tracking (Driver View) - EARN):** تتبع الأرباح وعرض سجل المدفوعات.
        -   **دعم السائق (Driver Support - SUPP):** الوصول إلى موارد الدعم أو الاتصال بوكلاء الدعم لحل المشكلات المتعلقة بالسائق.
-   **لوحة تحكم المتجر (Store Dashboard - S):**
    -   **ربط بمرحلة تطوير الواجهة الأمامية (relates to OP > DV > FE)**
        -   **إدارة الطلبات (عرض المتجر) (Order Management (Store View) - ORDM):** استقبال الطلبات الواردة وقبولها/رفضها وإدارتها.
        -   **إدارة القائمة (Menu Management - MENU):** تحديث قوائم المتجر، بما في ذلك إضافة/إزالة العناصر، وتغيير الأسعار، وإدارة التوفر.
        -   **إعدادات المتجر (Store Settings - STNG):** إدارة معلومات المتجر، مثل ساعات العمل ومناطق التوصيل وتفاصيل الاتصال.
        -   **تقارير المتجر (عرض المتجر) (Store Reporting (Store View) - RPT):** الوصول إلى التقارير والتحليلات حول أداء المتجر (مثل المبيعات وحجم الطلبات والعناصر الشائعة).
        -   **دعم المتجر (Store Support - SUPP):** الوصول إلى موارد الدعم أو الاتصال بوكلاء الدعم لحل المشكلات المتعلقة بالمتجر.
        -   **إدارة العروض الترويجية (Promotions Management - PROMO):** إنشاء عروض ترويجية للعملاء وإدارتها.
        -   **الإشعارات (المتجر) (Notifications (Store) - NOTF):** تلقي إشعارات حول الطلبات الجديدة وتحديثات الطلبات والمعلومات الأخرى ذات الصلة.
-   **لوحة التحكم الإدارية (Admin Panel - A):**
    -   **ربط بمرحلة تطوير الواجهة الأمامية (relates to OP > DV > FE)**
-   **المنسق المركزي (Meta-Orchestrator - M):**
    -   **ربط بمرحلة التصميم (relates to OP > DS)**
    -   **ربط بمرحلة تطوير الواجهة الخلفية (relates to OP > DV > BE)**
        -   **استقبال طلبات التوصيل (Order Request Reception - RECV):** استقبال طلبات التوصيل من تطبيق العميل.
        -   **توفر السائقين وتعيينهم (Driver Availability and Assignment - DRVA):** تحديد السائقين المتاحين وتعيينهم للطلبات بناءً على عوامل مثل الموقع والتوافر والملاءمة.
        -   **إدارة دورة حياة الطلب (Order Lifecycle Management - ORDM):** إدارة دورة حياة الطلب، بما في ذلك تحديثات الحالة والتتبع والتعامل مع التعديلات أو الإلغاءات.
        -   **الاتصال بين المكونات (Cross-Component Communication - COMM):** تسهيل الاتصال وتبادل البيانات بين تطبيق العميل ولوحة تحكم المتجر وتطبيق السائق.
        -   **معالجة الحالات الاستثنائية (Exception Handling - EXCP):** معالجة الاستثناءات والأخطاء التي قد تحدث أثناء دورة حياة الطلب (مثل فشل الدفع، عدم توفر السائق، إغلاق المتجر).
        -   **إدارة البيانات والأحداث (Data Management and Events - DATA):**
            - **نماذج البيانات (Data Models - MDLS):** هياكل البيانات والمخططات للكيانات الرئيسية (مثل الطلبات والمستخدمين والمتاجر والسائقين والعناصر). (سيتم تحديد التفاصيل لاحقًا)
            - **تخزين البيانات (Data Storage - STOR):** قواعد البيانات وحلول التخزين المستخدمة لأنواع مختلفة من البيانات. (مثل قاعدة بيانات علائقية للبيانات المنظمة، قاعدة بيانات NoSQL للبيانات المرنة) (سيتم تحديد التفاصيل لاحقًا)
            - **الوصول إلى البيانات (Data Access - ACSS):** واجهات برمجة التطبيقات والآليات للوصول إلى البيانات ومعالجتها. (مثل واجهات برمجة تطبيقات RESTful، GraphQL) (سيتم تحديد التفاصيل لاحقًا)
            - **اتساق البيانات وسلامتها (Data Consistency and Integrity - CONS):** استراتيجيات لضمان دقة البيانات واتساقها عبر المكونات والخدمات المختلفة. (مثل المعاملات، والتحقق من صحة البيانات) (سيتم تحديد التفاصيل لاحقًا)
            - **معالجة الأحداث (Event Handling - EVNT):** آليات لنشر الأحداث والاشتراك فيها ومعالجتها داخل النظام.
                - **أنواع الأحداث (Event Types - TYPE):** أنواع مختلفة من الأحداث المستخدمة في النظام (مثل إنشاء طلب، تعيين سائق، تحديث حالة الطلب، إكمال التسليم). (سيتم تحديد التفاصيل لاحقًا)
                - **نظام ناقل/مراسلة الأحداث (Event Bus/Messaging System - BUS):** التكنولوجيا المستخدمة لاتصالات الأحداث (مثل Kafka، RabbitMQ، ناقل الأحداث داخل الذاكرة). (سيتم تحديد التفاصيل لاحقًا)
                    -   **User Profile Updated:** حدث يتم تشغيله عند تحديث ملف تعريف المستخدم.
                     - **Store Menu Changed:** حدث يتم تشغيله عند تحديث قائمة المتجر.
                     - **Driver Availability Changed:** حدث يتم تشغيله عند تغيير حالة توفر السائق.
                    -   **Order Created:** حدث يتم تشغيله عند قيام العميل بتقديم طلب.
                        -   **مثال:** قيام العميل بتقديم طلب -> حدث "Order Created" -> Meta-Orchestrator يستقبل الحدث، ويبدأ التتبع.
                    -   **Driver Assigned:** حدث يتم تشغيله عند تعيين سائق للطلب.
                        -   **مثال:** Meta-Orchestrator يعين سائق -> حدث "Driver Assigned" -> تطبيق السائق يستقبل الحدث، ويخطر السائق.
                    -   **Order Status Updated:** حدث يتم تشغيله عند تغيير حالة الطلب.
                        -   **مثال:** قيام السائق بتحديث حالة الطلب -> حدث "Order Status Updated" -> Meta-Orchestrator يستقبل الحدث، ويحدث الحالة، وتطبيق العميل يستقبل الحدث، ويعرض التحديث.
                    - **Order Cancelled:** حدث يتم تشغيله عند إلغاء الطلب.
                        - **مثال:** قيام العميل بإلغاء الطلب -> حدث "Order Cancelled" -> Meta-Orchestrator يستقبل الحدث، ويحدث الحالة، ولوحة تحكم المتجر و/أو تطبيق السائق يستقبلان الحدث، ويتعاملان مع الإلغاء.
                    -   **Delivery Failed:** حدث يتم تشغيله عند عدم إمكانية إكمال التوصيل.
                        -   **مثال:** فشل السائق في التوصيل -> حدث "Delivery Failed" -> Meta-Orchestrator يستقبل الحدث، ويحدث الحالة، ويبدأ في إعادة التعيين أو الاتصال بالعميل.
                    -   **Message Sent:** حدث يتم تشغيله عند إرسال رسالة بين المكونات.
                        -   **مثال:** يرسل السائق رسالة -> حدث "Message Sent" -> Meta-Orchestrator يوجه/يسجل الرسالة، وتطبيق العميل يستقبل الرسالة، ويعرضها للعميل.
                - **الاشتراك في الأحداث ومعالجتها (Event Subscription and Handling - SUBS):** كيف تشترك المكونات المختلفة في أنواع أحداث محددة وكيف تعالجها. (سيتم تحديد التفاصيل لاحقًا)
                    - **Promotional Offer Event:** حدث متعلق بإنشاء أو تعديل أو تفعيل العروض الترويجية.
                    -   **اشتراكات تطبيق العميل (Customer App Subscriptions - CUST):**
                        - **تحديثات حالة الطلب (تطبيق العميل) (Order Status Updates (Customer App) - STAT):** يشترك تطبيق العميل في تحديثات حالة الطلب لعرض الحالة الحالية للعميل.
                    - **اشتراكات لوحة تحكم المتجر (Store Dashboard Subscriptions - STOR):**
                        -   **أحداث الطلبات الجديدة (New Order Events - NEWO):** تشترك لوحة تحكم المتجر في أحداث الطلبات الجديدة لإخطار المتجر بالطلبات الواردة.
                        -  **أحداث إلغاء الطلب (لوحة تحكم المتجر) (Order Cancellation Events (Store Dashboard) - CANC):** تشترك لوحة تحكم المتجر في أحداث إلغاء الطلب لإخطار المتجر بالطلبات الملغاة.
                    -   **اشتراكات تطبيق السائق (Driver App Subscriptions - DRIV):**
                        -   **أحداث تعيين الطلب (Order Assignment Events - ASGN):** يشترك تطبيق السائق في أحداث تعيين الطلب لتنبيه السائقين بعمليات التوصيل المتاحة.
                        - **أحداث إلغاء الطلب (تطبيق السائق) (Order Cancellation Events (Driver App) - CANC):** يشترك تطبيق السائق في أحداث إلغاء الطلب لإخطار السائقين بالطلبات الملغاة.
        - **تطبيق العميل (Customer App - C):**
                         - **Message Received:** يشترك تطبيق العميل في أحداث الرسائل لعرض الرسائل من المكونات الأخرى (مثل السائقين).
                          -   **مثال:** Meta-Orchestrator يوجه حدث "Message Sent" -> تطبيق العميل يستقبل الحدث، ويعرض الرسالة.
        - **Store Menu Updates (Customer App):** يشترك تطبيق العميل في تحديثات قائمة المتجر لعرض أحدث معلومات القائمة.
        -  **Promotional Offers (Customer App):** يشترك تطبيق العميل في أحداث العروض الترويجية لعرض العروض الحالية.
            - **تصفح المتاجر والقوائم (Browsing Stores and Menus - BRWS):**
            - **تقديم الطلب (Order Placement - ORD):**
            - **تتبع الطلب (عرض العميل) (Order Tracking (Customer View) - TRCK):**
            - **إدارة الملف الشخصي (العميل) (Profile Management (Customer) - PROF):**   
            - **دعم العملاء (Customer Support - SUPP):**
            - **سجل الطلبات (عرض العميل) (Order History (Customer View) - HIST):**
        - **تطبيق العميل (Customer App - C):**
            -   **Order Management (Customer App):**
                -   **مثال:** يعرض رسائل الحالة المختلفة (مثل "تم استلام الطلب"، "جاري التحضير"، "في الطريق")، ويوفر خيارات للاتصال بالسائق أو الدعم.
            -   **Communication (Customer App):**
                -   **مثال:** يعرض محتوى الرسائل من السائق، ويوفر خيارات للرد على السائق.
            -   **Promotions (Customer App):**
                -   **مثال:** يعرض تفاصيل العروض الترويجية المتاحة، ويسمح للمستخدمين بتطبيق العروض على طلباتهم.
        -   **لوحة تحكم المتجر (Store Dashboard - S):**
            -   **Order Management (Store Dashboard):**
                -   **مثال:** يعرض معلومات مفصلة حول الطلبات الجديدة (مثل العناصر، تفاصيل العميل، عنوان التوصيل)، ويوفر خيارات لقبول الطلبات أو رفضها، وإدارة حالة تحضير الطلب (مثل "جاري التحضير"، "جاهز للاستلام").
                -  **مثال:** يحدّث حالة الطلب عند الإلغاء، ويخطر موظفي المتجر بالإلغاء، وربما يقدم سبب الإلغاء (إن أمكن).
            -   **Menu Management (Store Dashboard):**
                -   **مثال:** يتفاعل مع Meta-Orchestrator لنشر تغييرات القائمة، وتحديث معلومات القائمة المعروضة للعملاء.
        -   **تطبيق السائق (Driver App - D):**
            -   **Order Management (Driver App):**
                -   **مثال:** يعرض معلومات مفصلة حول مهام التوصيل المخصصة (مثل موقع الاستلام، عنوان التوصيل، العناصر)، ويوفر تعليمات التنقل، ويسمح للسائقين بقبول مهام التوصيل أو رفضها.
                -  **مثال:** يشغل تغييرات حالة الطلب (مثل "تم استلام الطلب"، "في الطريق"، "تم التوصيل")، ويتواصل مع العميل أو المتجر لتأكيد تفاصيل التوصيل أو حل المشكلات.
            -   **Communication (Driver App):**
                -   **مثال:** يسمح للسائقين بإرسال رسائل إلى العملاء (مثل لتأكيد وقت الوصول أو توضيح تعليمات التوصيل)، وربما يسمح بالاتصال مع Meta-Orchestrator (مثل للإبلاغ عن المشكلات أو تحديث الحالة).
        -   **Asynchronous Operations Handling:**
            - **Callbacks:**
                - **ملاحظة:** تفاصيل حول تسجيل ردود الاتصال واستدعائها ومعالجتها.
            - **Promises/Futures:**
                - **ملاحظة:** تفاصيل حول إنشاء الوعود/المستقبليات وتسلسلها ومعالجتها.
            - **Task Queues:**
                                - **مثال:** Meta-Orchestrator ينشر حدث "Order Cancelled" -> لوحة تحكم المتجر تستقبل الحدث، وتتعامل مع الإلغاء (مثل إيقاف تحضير الطلب).
                                        -   **اشتراكات تطبيق السائق (Driver App Subscriptions - DRIV):**
                         - **Order Cancellation Events (Driver App):** يشترك تطبيق السائق في أحداث إلغاء الطلب لإخطار السائقين بالطلبات الملغاة.
                             - **مثال:** Meta-Orchestrator ينشر حدث "Order Cancelled" -> تطبيق السائق يستقبل الحدث، ويتعامل مع الإلغاء (مثل إزالة التوصيل من المهام المخصصة).
         - **لوحة تحكم المتجر (Store Dashboard - S):**
             -   **Order Management (Store Dashboard):**
             -   **Menu Management (Store Dashboard):**
                 -   **مثال:** يتفاعل مع Meta-Orchestrator لنشر تغييرات القائمة، وتحديث معلومات القائمة المعروضة للعملاء.
         - **تطبيق السائق (Driver App - D):**
             -   **Order Management (Driver App):**
                 -   **مثال:** يعرض معلومات مفصلة حول مهام التوصيل المخصصة (مثل موقع الاستلام، عنوان التوصيل، العناصر)، ويوفر تعليمات التنقل، ويسمح للسائقين بقبول مهام التوصيل أو رفضها.
                 -  **مثال:** يشغل تغييرات حالة الطلب (مثل "تم استلام الطلب"، "في الطريق"، "تم التوصيل")، ويتواصل مع العميل أو المتجر لتأكيد تفاصيل التوصيل أو حل المشكلات.
             -   **Communication (Driver App):**
                - **ملاحظة:** تفاصيل حول قوائم المهام المستخدمة.
                - **ملاحظة:** تفاصيل حول القوائم المحددة، وتنسيقات المهام، وآليات الإرسال والمعالجة.

            - **إعادة الطلب (Reordering - RCOM):**
            - **الإشعارات (العميل) (Notifications (Customer) - NOTF):**
    -   **إدارة الطلبات (Order Management - ORD):**
        -   **إنشاء الطلب والتحقق منه (Order Creation and Validation - CRT):**
            -   **قواعد التحقق من الطلب (Order Validation Rules - VAL):**
                -   **التحقق من توفر المتجر (Store Availability Check - STAV):**
                -   **التحقق من توفر المنتج (Item Availability Check - ITAV):**
                -   **التحقق من صحة العنوان (Address Validity Check - ADVAL):**
            -   **إنشاء معرف الطلب (Order ID Generation - OIDG):**
            -   **حدث إنشاء الطلب (Order Created Event - EVNT):**
             - **التحقق من صحة البيانات (Data Validation - VAL):**
                -   عند تعديل عناصر الطلب، قد تحدث أخطاء تتعلق بصحة البيانات المدخلة. تشمل هذه الأخطاء:
                    -   معرف منتج غير صالح: يشير إلى أن معرف المنتج غير موجود في فهرس المنتجات.
                    -   كمية غير صالحة: تشير إلى أن الكمية المدخلة ليست عددًا صحيحًا موجبًا أو تتجاوز الحد الأقصى المسموح به.
                    -   سمات غير صالحة: تشير إلى أن السمات المحددة للعنصر غير صالحة للمنتج المحدد (مثل الخيارات غير الصحيحة للمنتجات القابلة للتخصيص).
                -   يجب معالجة هذه الأخطاء بشكل صحيح وإرجاع رسائل خطأ واضحة للمستخدم.
            - **التحقق من صحة بيانات الطلب (Order Data Validation - VAL):**
                - **التحقق من صحة المنتجات (Product Validation - PROD):**
                   -   التأكد من وجود جميع المنتجات في الطلب في قائمة المنتجات.
                   -   التحقق من صحة معرف المنتج، ووصف المنتج، والسعر، والسمات.
                - **التحقق من صحة الكمية (Quantity Validation - QTY):**
                   -   التأكد من أن الكمية أكبر من 0.
                   -   التأكد من أن الكمية لا تتجاوز الحد الأقصى المتاح.
                   -   التأكد من أن الكمية عدد صحيح.
                - **التحقق من صحة السمات (Attributes Validation - ATTR):**
                   -   التأكد من أن جميع السمات المحددة صحيحة ومتوفرة للمنتج.
                   -   التحقق من صحة قيم السمات.

            -   **معايير اختيار السائق (Driver Selection Criteria - DRSL):**
                -   **القرب من المتجر (Proximity to Store - LOC):**
                -   **تقييم السائق ومراجعاته (Driver Rating and Reviews - RTG):**
                -   **عبء عمل السائق وتوافره (Driver Workload and Availability - WL):**
                -   **المعدات (Equipment - EQPT):**
            -   **خوارزمية تعيين السائق (Driver Assignment Algorithm - ALGO):**
            -   **إخطار السائق وقبوله (Driver Notification and Acceptance - NOTF):**
        -   **تعيين الطلب للسائق (Order Assignment to Driver - ASSN):**
            -   **حدث تعيين الطلب (Order Assigned Event - EVNT):**
        -   **تتبع الطلب وتحديث حالته (Order Tracking and Status Updates - TRAC):**
            -   **حالات الطلب (Order Statuses - STAT):**
                -   **قيد التعيين (Pending Assignment - PEND):**
                -   **تم تعيينه للسائق (Assigned to Driver - ASGN):**
                -   **تم استلامه من المتجر (Picked Up from Store - PICK):**
                -   **قيد النقل (In Transit - INTR):**
                -   **تم التوصيل (Delivered - DELV):**
                -   **تم الإلغاء (Cancelled - CXL):**
            -   **أحداث تحديث الحالة (Status Update Events - EVNT):**
            -   **إدارة البيانات والأحداث (Data Management and Events - DATA):**
                    -   **اتساق البيانات (Data Consistency - CONS):** آليات ضمان اتساق البيانات عبر المكونات المختلفة (سيتم تحديد التفاصيل لاحقًا).
                    -   **معالجة الأحداث (Event Handling - EVNT):** كيفية تعامل Meta-Orchestrator مع الأحداث المتعلقة بدورة حياة الطلب (سيتم تحديد التفاصيل لاحقًا).
                    -   **التقنيات (Technologies - TECH):** التقنيات المستخدمة لإدارة البيانات ومعالجة الأحداث (سيتم تحديد التفاصيل لاحقًا).
        -   **التعامل مع الحالات الاستثنائية (Exception Handling - EXCP):**
             -   **أنواع الحالات الاستثنائية (Exception Types - TYPE):** أنواع الحالات الاستثنائية التي يمكن أن تحدث (مثل فشل الدفع، عدم توفر سائق، تأخير في التسليم) (سيتم تحديد التفاصيل لاحقًا).
             -    **إجراءات التعامل (Handling Procedures - PROC):** إجراءات التعامل مع أنواع مختلفة من الحالات الاستثنائية (مثل آليات إعادة المحاولة، الإشعارات، التدخل اليدوي) (سيتم تحديد التفاصيل لاحقًا).
        -   **إلغاء الطلب (Order Cancellation - CXL):**
            -   **مبادرو الإلغاء (Cancellation Initiators - INITI):** من يمكنه بدء الإلغاء (العميل، المتجر، النظام).
                -   **بواسطة العميل (Customer-Initiated - CUST):** الإلغاء من قبل العميل.
                -   **بواسطة المتجر (Store-Initiated - STOR):** الإلغاء من قبل المتجر.
            -   **قيود المرحلة (Stage Restrictions - STAG):** القيود على مراحل دورة حياة الطلب التي يُسمح فيها بالإلغاء (سيتم تحديد التفاصيل لاحقًا).
            -   **قواعد وقيود الإلغاء (Cancellation Rules and Constraints - RULE):** القواعد والقيود المتعلقة بالإلغاء (مثل الحدود الزمنية ورسوم الإلغاء) (سيتم تحديد التفاصيل لاحقًا).
            -   **الإشعارات (Notifications - NOTF):** إخطار الأطراف المعنية (العميل، السائق، المتجر) بالإلغاء.
        -   **إلغاء الطلب (Order Cancellation - CXL):**
    -  **مثال:**
    -   **ملاحظة:** قد ينشر Meta-Orchestrator أحداث USER و MENU و DRIV لإعلام المكونات الأخرى بهذه التغييرات. قد يشترك في أحداث PROM لإدارة تطبيق العروض الترويجية على الطلبات.
        -   **ملاحظة:** ينشر تطبيق العميل أحداث USER عند تحديث المستخدم معلومات ملفه الشخصي.
        -   **ملاحظة:** تنشر لوحة تحكم المتجر أحداث MENU عندما يقوم المتجر بتحديث قائمته.
        -   **ملاحظة:** ينشر تطبيق السائق أحداث DRIV عندما يغير السائق حالة توفره.





### القرارات الرئيسية

-   **استخدام قاعدة بيانات SQL (Use SQL Database - DB-SQL):**
-   **استخدام واجهة برمجة تطبيقات RESTful (Use RESTful API - API-REST):**
-   **استخدام React للواجهة الأمامية (Use React for Frontend - FE-REACT):**

### المهام

-   **إعداد مستودع المشروع (Set up project repository - 001):**
-   **تصميم مخطط قاعدة البيانات (Design database schema - 002):**
## Smart Delivery Platform (SDP)

## Deployment and Infrastructure

هذا القسم يصف تفاصيل نشر وتشغيل المنصة، بما في ذلك المكدس التقني والبنية التحتية المستخدمة.

---

### Deployment and Infrastructure

#### Scalability and Performance

*   **Horizontal Scaling:**
    *   يمكن توسيع نطاق Meta-Orchestrator أفقيًا داخل مجموعة Kubernetes بناءً على استخدام وحدة المعالجة المركزية (CPU) والذاكرة.
    *   وجود سياسة توسيع تلقائي لضبط عدد المثيلات تلقائيًا.
    *   توسيع نطاق Celery workers بشكل مستقل بناءً على طول قوائم المهام التي يستهلكونها.
    *   وجود مجموعة من العاملين لكل قائمة يمكن توسيع نطاقها بشكل مستقل.
*   **Database Scaling:**
    *   استخدام قاعدة بيانات PostgreSQL على AWS RDS لنسخ القراءة لتفريغ حركة مرور القراءة من مثيل قاعدة البيانات الأساسي.
    *   تكوين التطبيق لتوجيه استعلامات القراءة إلى النسخ المتماثلة.
    *   تنفيذ تجميع اتصالات قاعدة البيانات باستخدام PgBouncer لإدارة اتصالات قاعدة البيانات بكفاءة وتقليل الحمل الزائد للاتصال.
*   **Caching:**
    *   استخدام Redis (المستضاف على Redis Cloud) للتخزين المؤقت.
    *   تخزين قوائم المتاجر مؤقتًا بـ TTL (وقت البقاء) يبلغ 60 ثانية.
    *   تخزين ملفات تعريف المستخدم مؤقتًا بـ TTL يبلغ 300 ثانية.
    *   تخزين بيانات التكوين شائعة الاستخدام مؤقتًا إلى أجل غير مسمى.
*   **Load Balancing:**
    *   قيام Kubernetes LoadBalancer بتوزيع حركة المرور الواردة عبر مثيلات متعددة من Meta-Orchestrator.
    *   استخدام موازن التحميل لخوارزمية round-robin لتوزيع حركة المرور.
*   **Asynchronous Processing:**
    *   استخدام قوائم الرسائل (RabbitMQ) وقوائم المهام (Celery) على نطاق واسع لفصل الخدمات والتعامل مع المهام غير المتزامنة، مثل إرسال الإشعارات ومعالجة المدفوعات وإنشاء التقارير.
    *   هذا يمنع المهام طويلة الأمد من حظر طلبات المستخدم ويحسن الاستجابة العامة.
*   **Monitoring and Alerting:**
    *   استخدام Prometheus لجمع المقاييس من جميع الخدمات، بما في ذلك استخدام وحدة المعالجة المركزية والذاكرة، وأوقات استجابة API، وأداء استعلام قاعدة البيانات، وأطوال قائمة المهام.
    *   استخدام Grafana لتصور المقاييس التي جمعتها Prometheus وإنشاء لوحات معلومات لمراقبة سلامة النظام وأدائه.
    *   تكوين التنبيهات في Grafana لإخطار فريق العمليات عبر Slack والبريد الإلكتروني عندما تتجاوز مقاييس الأداء عتبات محددة مسبقًا (مثل زمن انتقال API مرتفع، واستخدام وحدة المعالجة المركزية مرتفع، وطول قائمة المهام مرتفع).
*   **Code Optimization:**
    *   تحسين استعلامات قاعدة البيانات باستخدام الفهارس وتجميع الاتصالات وأنماط الاستعلام الفعالة (مثل تجنب استعلامات N+1).
    *   اختيار الخوارزميات لتقليل التعقيد الحسابي وتحسين الأداء، خاصة في مسارات التعليمات البرمجية الحرجة.
    *   استخدام أدوات التنميط لتحديد اختناقات الأداء في التعليمات البرمجية، وتطبيق التحسينات بناءً على نتائج التنميط.    
    
---

#### Data Storage and Messaging

*   **Databases:** قاعدة بيانات PostgreSQL مستضافة على AWS RDS (Relational Database Service).
*   **Message Queues:** RabbitMQ مستضاف على CloudAMQP (خدمة RabbitMQ مُدارة).
*   **Caching:**
    *   استخدام Redis (المستضاف على Redis Cloud) للتخزين المؤقت.
    *   تخزين قوائم المتاجر مؤقتًا بـ TTL (وقت البقاء) يبلغ 60 ثانية.
    *   تخزين ملفات تعريف المستخدم مؤقتًا بـ TTL يبلغ 300 ثانية.
    *   تخزين بيانات التكوين شائعة الاستخدام مؤقتًا إلى أجل غير مسمى.
    *   **Caching Order Details:**

---

#### مكونات النشر

*   **Meta-Orchestrator:** يتم نشره كتطبيق معبأ في حاويات باستخدام Docker، ومنسق باستخدام Kubernetes على Google Kubernetes Engine (GKE).
*   **Customer App:**
    *   **تطبيق الويب:** يتم نشره كموقع ويب ثابت على Netlify.
    *   **تطبيق الجوال:** يتم توزيعه عبر Apple App Store و Google Play Store، ويستخدم Firebase لمصادقة المستخدمين والإشعارات الفورية.
*   **Store Dashboard:** يتم نشره كتطبيق ويب على Vercel.
*   **Driver App:**
    *   **تطبيق الجوال:** يتم توزيعه عبر Apple App Store و Google Play Store، ويستخدم Firebase لمصادقة المستخدمين والإشعارات الفورية.
*   **Data Storage and Messaging:**
    *   **Databases:** قاعدة بيانات PostgreSQL مستضافة على AWS RDS (Relational Database Service).
    *   **Message Queues:** RabbitMQ مستضاف على CloudAMQP (خدمة RabbitMQ مُدارة).
*   **Asynchronous Task Processing:** يتم نشر Celery workers كحاويات منفصلة داخل مجموعة Kubernetes على GKE.
*   **Monitoring:** يتم استخدام Prometheus و Grafana للمراقبة والتنبيه.
*   **Security:**
    *   يتم استخدام HTTPS لجميع الاتصالات.
    *   يتم استخدام JWT (JSON Web Tokens) لمصادقة API.
    *   يتم تشفير البيانات الحساسة في حالة الراحة باستخدام تشفير AES-256.
    *   يتم إجراء عمليات تدقيق أمني واختبار اختراق منتظمة.

---

### Technology Stack # المكدس التقني

#### Meta-Orchestrator

*   **لغة البرمجة:** Python
*   **الإطار:** Django
*   **قاعدة البيانات:** PostgreSQL
*   **المكتبات:**
    *   Django REST Framework (لواجهات API)
    *   Celery (للمهام غير المتزامنة)
    *   Psycopg2 (محول PostgreSQL)

#### Customer App

*   **تطبيق الويب:**
    *   **الإطار:** React
    *   **المكتبات:**
        *   Axios (لطلبات API)
        *   React Router (للتنقل)
        *   Redux (لإدارة الحالة)
*   **تطبيق الجوال:**
    *   **لغات البرمجة:** Swift (iOS) و Kotlin (Android)
    *   **الإطار:** أصلي iOS/Android باستخدام SwiftUI لـ iOS و Jetpack Compose لـ Android.
    *   **المكتبات:**
        *   Alamofire (iOS، للشبكات)
        *   Retrofit (Android، للشبكات)
        *   Kotlin Coroutines (Android، للعمليات غير المتزامنة)

#### Store Dashboard

*   **الإطار:** React
*   **المكتبات:**
    *   Ant Design (مكتبة واجهة المستخدم)
    *   Axios
    *   React Router
    *   Redux

#### Driver App

*   **تطبيق الجوال:**
    *   **لغات البرمجة:** Swift (iOS) و Kotlin (Android)
    *   **الإطار:** أصلي iOS/Android باستخدام UIKit لـ iOS ومكونات واجهة مستخدم Android القياسية.
    *   **المكتبات:**
        *   CoreLocation (iOS، لخدمات الموقع)
        *   MapKit (iOS، للخرائط)
        *   Retrofit (Android، للشبكات)
        *   Google Maps SDK (Android، للخرائط)

---

#### API Documentation and Versioning

*   **Documentation Tools:**
    *   Swagger/OpenAPI.
*   **Versioning Scheme:**
    *   الإصدار الدلالي.
*   **Backward Compatibility:**
    *   التواصل مع المستهلكين ومعالجة التغييرات الجذرية.
















    SDP > M: Meta-Orchestrator
         
                    OP > SDP > M > COMM: Inter-Component Communication
                                 # آليات الاتصال بين المكونات.
                                            OP > SDP > M > COMM > MQUE: Message Queues
                                                                        # Note: Details about message queues used.
                                                                                        # Example: RabbitMQ is used for asynchronous communication.
                                                                                                        # Example: Specific queues include:
                                                                                                                        #   - `order_events`: For order-related events (e.g., creation, cancellation, status updates). Messages are JSON-formatted and include order ID, event type, and relevant data.
                                                                                                                                        #   - `driver_location_updates`: For driver location updates. Messages are JSON-formatted and include driver ID, latitude, longitude, and timestamp.
                                                                                                                                                        # Example: Components publish events to queues, and interested components subscribe to specific event types.
                                                                                                                                                                        OP > SDP > M > COMM > API: APIs
                                                                                                                                                                                    # Note: Details about APIs used.
                                                                                                                                                                                                    # Example: RESTful APIs are used for synchronous communication, primarily between the Customer App, Store Dashboard, Driver App, and the Meta-Orchestrator.
                                                                                                                                                                                                                    # Example: API endpoints include:
                                                                                                                                                                                                                                    #   - `/orders`: For creating, retrieving, and updating orders. Uses JSON for request and response bodies.
                                                                                                                                                                                                                                                    #   - `/stores`: For retrieving store information and menus. Uses JSON for request and response bodies.
                                                                                                                                                                                                                                                                    #   - `/drivers`: For retrieving driver information and managing availability. Uses JSON for request and response bodies.
                                                                                                                                                                                                                                                                                    # Example: Authentication is handled using JWT (JSON Web Tokens).
                                                                                                                                                                                                                                                                                            OP > SDP > M > COMM > PROT: Communication Protocols
                                                                                                                                                                                                                                                                                                        # Note: Details about communication protocols used.
                                                                                                                                                                                                                                                                                                                        # Example: HTTP/1.1 and HTTP/2 are used for API communication.
                                                                                                                                                                                                                                                                                                                                OP > SDP > M > DATA: Data Management and Events
                                                                                                                                                                                                                                                                                                                                            # ... other data management details ...
                                                                                                                                                                                                                                                                                                                                                        OP > SDP > M > DATA > CONS: Data Consistency and Integrity
                                                                                                                                                                                                                                                                                                                                                                        # Note: Strategies for ensuring data accuracy and consistency across different components and services.
                                                                                                                                                                                                                                                                                                                                                                                        OP > SDP > M > DATA > CONS > TRAN: Transactions
                                                                                                                                                                                                                                                                                                                                                                                                    # Note: Details about transaction management.
                                                                                                                                                                                                                                                                                                                                                                                                                        # Example: Database transactions are used within the Meta-Orchestrator to ensure atomicity of operations that involve multiple database updates.
                                                                                                                                                                                                                                                                                                                                                                                                                                        OP > SDP > M > DATA > CONS > VALI: Data Validation
                                                                                                                                                                                                                                                                                                                                                                                                                                                            # Note: Mechanisms for data validation.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                        # Example: API requests are validated using schema validation (e.g., using a library like `jsonschema` in Python).
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            # Example: Business rules are enforced within the Meta-Orchestrator to prevent invalid operations.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            # Validate updated order total
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            # تعتمد رسوم الشحن على وزن الطلب وعنوان التسليم.
# 1. Calculate the total amount of items: sum (item price * item quantity) for all items.

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            # 2. Apply item-level discounts/promotions to the total amount of items.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            # 3. Calculate shipping fees.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            # 4. Calculate taxes.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            # 5. Apply order-level discounts/promotions.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            # 6. Calculate the final total: total amount of items + shipping fees + taxes - order-level discounts.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            OP > SDP > M > DATA > CONS > EVEN: Eventual Consistency
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                # Note: Strategies for handling eventual consistency, if applicable.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    # Example: Eventual consistency is accepted for driver location data.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    # Example: Slight inconsistencies might occur due to network latency, but are tolerated as long as they do not significantly impact order assignment or delivery tracking.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            OP > SDP > M > ASYN: Asynchronous Operations Handling
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        # Note: Mechanisms for handling asynchronous operations.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                OP > SDP > M > ASYN > TQUE: Task Queues
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        # Note: Details about task queues used.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        # Example: Celery (with RabbitMQ as the broker) is used to manage asynchronous tasks.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        # Example: Specific queues include:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        #   - `notifications`: For sending notifications (e.g., order confirmation emails, SMS messages to drivers).
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        #   - `payments`: For processing payments.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        #   - `reports`: For generating reports.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                # Example: Tasks are added to queues with relevant data.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                ## Smart Delivery Platform (SDP)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                # ... existing SDP sections ...
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    OP > SDP > TECH: Technology Stack#  المكدس التقني
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     # Note: Technologies used in the Smart Delivery Platform.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             OP > SDP > TECH > META: Meta-Orchestrator
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         # Note: Technologies used for the Meta-Orchestrator.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 # Example: Programming Language: Python
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         # Example: Framework: Flask or Django
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 # Example: Database: PostgreSQL or MySQL
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         OP > SDP > TECH > CUST: Customer App
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     # Note: Technologies used for the Customer App.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             # Example (Web): Framework: React, Angular, or Vue.js
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         # Example (Mobile): Programming Languages: Swift (iOS) and Kotlin (Android)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 # Example (Mobile): Framework: Native iOS/Android or React Native/Flutter
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         OP > SDP > TECH > STOR: Store Dashboard
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     # Note: Technologies used for the Store Dashboard.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             # Example: Framework: React, Angular, or Vue.js
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     OP > SDP > TECH > DRIV: Driver App
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 # Note: Technologies used for the Driver App.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             # Example (Mobile): Programming Languages: Swift (iOS) and Kotlin (Android)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     # Example (Mobile): Framework: Native iOS/Android or React Native/Flutter
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     ## Smart Delivery Platform (SDP)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     # ... existing SDP sections ...
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         OP > SDP > TECH: Technology Stack
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 # ... existing technology details ...
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         OP > SDP > TECH > ORM: ORM Usage
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     # ... (existing ORM usage examples) ...
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 # Transaction Management:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             #   ... (existing transaction management example) ...
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 OP > SDP > INFR: Deployment and Infrastructure
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         # ... existing infrastructure details ...
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 OP > SDP > INFR > DATA: Data Storage and Messaging
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             # ... existing data storage details ...
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         OP > SDP > INFR > DATA > DB: Databases
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         # ... existing database details ...
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         # Database Schema
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         #   ... (existing schema details for orders and order_items tables) ...
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         # Indexing Strategy
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         #   ... (existing indexing strategy details) ...
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         # Optimized SQL Queries
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         #   ... (existing optimized SQL query details) ...
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     OP > SDP > INFR > DATA > CACHE: Caching
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     # Caching Order Details:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     #   ... (existing caching order details example) ...
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     # Cache Invalidation:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     #   ... (existing cache invalidation for order status changes) ...
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     #   ... (existing cache invalidation for order item modifications) ...
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     # Caching Strategy for Orders (Summary):
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     #   ... (existing caching strategy summary) ...
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             OP > SDP > TECH > DATA_VALIDATION: Data Validation
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         # Order Data Validation:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     #   - Order Creation:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 #       ... (existing validation rules for order creation) ...
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             #   - Order Updates:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         #       ... (existing validation rules for order updates, including delivery address) ...
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     #   - Order Item Modifications:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 #     - Item Operations:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             #       - Adding Items:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         #         - product_id: Must exist in the product catalog
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     #         - quantity: Must be a positive integer (and potentially below a maximum limit)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 #         - Other attributes:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             #           - Must be valid for the given product (e.g., valid options for customizable products)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         #       - Removing Items:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     #         - (e.g., item must exist in the order)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 #         - (e.g., removal may be restricted based on order status)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             #       - Updating Items:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         #         - quantity: Must be a positive integer (and potentially below a maximum limit)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     #         - Other attributes:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 #           - Must be valid for the given product (e.g., valid options for customizable products)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             #     - Aggregate Validation:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         #       - Validate updated order total:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     #         - Recalculate total based on item prices, quantities, discounts, and promotions.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 #         - Ensure recalculated total is consistent with expected value.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             #         - Calculation Steps:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         #           1. Calculate subtotal: Sum (item price * item quantity) for all items.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     #           2. Apply item-level discounts/promotions to subtotal (price of individual items may be reduced):
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 #             - Examples: Percentage discounts (e.g., 10% off), Fixed amount discounts (e.g., $5 off).
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             #           3. Calculate shipping fees:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         #             - Based on order weight and delivery address, using potentially different models.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     #           4. Calculate taxes.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 #           5. Apply order-level discounts/promotions.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             #           6. Calculate final total: subtotal + shipping fees + taxes - order-level discounts.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         #     - Error Handling:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     #       - Input Validation Errors:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 #         - Invalid Product ID:  # Specific error type
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             #           - Error Message: "Invalid Product ID."
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         #         - Invalid Quantity:  # Specific error type
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     #           - Error Message: "Invalid Quantity."
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 #         - Invalid Attributes:  # Specific error type
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             #           - Error Message: "Invalid Attributes."
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         #       - Business Logic Errors:  # New subsection for business logic errors
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     #         - (Further details to be added based on subsequent conversations)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     ## Smart Delivery Platform (SDP)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     # ... existing SDP sections ...
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         OP > SDP > TECH: Technology Stack
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 # ... existing technology details ...
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         OP > SDP > TECH > ORM: ORM Usage
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     # ... (existing ORM usage examples) ...
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 # Transaction Management:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             #   ... (existing transaction management example) ...
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 OP > SDP > INFR: Deployment and Infrastructure
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         # ... existing infrastructure details ...
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 OP > SDP > INFR > DATA: Data Storage and Messaging
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             # ... existing data storage details ...
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         OP > SDP > INFR > DATA > DB: Databases
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         # ... existing database details ...
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         # Database Schema
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         #   ... (existing schema details for orders and order_items tables) ...
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         # Indexing Strategy
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         #   ... (existing indexing strategy details) ...
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         # Optimized SQL Queries
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         #   ... (existing optimized SQL query details) ...
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     OP > SDP > INFR > DATA > CACHE: Caching
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     # Caching Order Details:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     #   ... (existing caching order details example) ...
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     # Cache Invalidation:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     #   ... (existing cache invalidation for order status changes) ...
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     #   ... (existing cache invalidation for order item modifications) ...
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     # Caching Strategy for Orders (Summary):
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     #   ... (existing caching strategy summary) ...
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             OP > SDP > TECH > DATA_VALIDATION: Data Validation
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         # Order Data Validation:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     #   - Order Creation:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 #       ... (existing validation rules for order creation) ...
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             #   - Order Updates:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         #       ... (existing validation rules for order updates, including delivery address) ...
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     #   - Order Item Modifications:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 #     - Item Operations:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             #       - Adding Items:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         #         - product_id: Must exist in the product catalog
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     #         - quantity: Must be a positive integer (and potentially below a maximum limit)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 #         - Other attributes:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             #           - Must be valid for the given product (e.g., valid options for customizable products)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         #       - Removing Items:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     #         - (e.g., item must exist in the order)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 #         - (e.g., removal may be restricted based on order status)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             #       - Updating Items:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         #         - quantity: Must be a positive integer (and potentially below a maximum limit)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     #         - Other attributes:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 #           - Must be valid for the given product (e.g., valid options for customizable products)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             #     - Aggregate Validation:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         #       - Validate updated order total:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     #         - Recalculate total based on item prices, quantities, discounts, and promotions.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 #         - Ensure recalculated total is consistent with expected value.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             #         - Calculation Steps:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         #           1. Calculate subtotal: Sum (item price * item quantity) for all items.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     #           2. Apply item-level discounts/promotions to subtotal (price of individual items may be reduced):
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 #             - Examples: Percentage discounts (e.g., 10% off), Fixed amount discounts (e.g., $5 off).
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             #           3. Calculate shipping fees:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         #             - Based on order weight and delivery address, using potentially different models.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     #           4. Calculate taxes.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 #           5. Apply order-level discounts/promotions.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             #           6. Calculate final total: subtotal + shipping fees + taxes - order-level discounts.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         #     - Error Handling:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     #       - Input Validation Errors:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 #         - Invalid Product ID:  # Specific error type
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             #           - Error Message: "Invalid Product ID."
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         #         - Invalid Quantity:  # Specific error type
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     #           - Error Message: "Invalid Quantity."
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 #         - Invalid Attributes:  # Specific error type
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             #           - Error Message: "Invalid Attributes."
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         #       - Business Logic Errors:  # New subsection for business logic errors
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     #         - (Further details to be added based on subsequent conversations)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     ## 